const { Events, ApplicationCommandOptionType, StringSelectMenuBuilder, ActionRowBuilder, ButtonBuilder, ModalBuilder, EmbedBuilder, ButtonStyle, TextInputBuilder, TextInputStyle } = require("discord.js");
const ertucuk = require("../../../../../../Global/Settings/System");
const ertum = require("../../../../../../Global/Settings/Setup.json");
const { star } = require("../../../../../../Global/Settings/Emojis.json");

module.exports = {
    name: "destek",
    description: "Destek Sistemi",
    category: "OWNER",
    cooldown: 0,
    command: {
        enabled: true,
        aliases: ["support"],
        usage: ".support",
    },

    onLoad: function (client) {
        client.on(Events.InteractionCreate, async interaction => {
            if (interaction.customId == "basvur") {
                const modal = new ModalBuilder()
                    .setCustomId("ybasvuru")
                    .setTitle("Yetkili Ba≈üvurusu");
    
                const questions = [
                    { id: "soru1", label: "ƒ∞sim Ve Ya≈üƒ±nƒ±z", placeholder: "Buraya ƒ∞sim Ve Ya≈üƒ±nƒ±zƒ± Yazƒ±n. / √ñrn: Ertu 18", style: TextInputStyle.Short },
                    { id: "soru2", label: "G√ºnde Ka√ß Saat Aktifsiniz", placeholder: "G√ºnde Ka√ß Saat Aktif Olduƒüunuzu Yazƒ±n. / √ñrn: 8 Saat", style: TextInputStyle.Short },
                    { id: "soru3", label: "Sunucumuz i√ßin neler yapabilirsiniz?", placeholder: "Ne Yapabileceƒüinizi Yazƒ±n. / √ñrn: 5 Davet", style: TextInputStyle.Short },
                    { id: "soru4", label: "Bize biraz kendinizden bahseder misiniz?", placeholder: "Ne Yapmaktan Ho≈ülandƒ±ƒüƒ±nƒ±zƒ± Yazƒ±n. / √ñrn: Sohbet Etmek", style: TextInputStyle.Paragraph }
                ];
    
                const modalComponents = questions.map(q => new TextInputBuilder()
                    .setCustomId(q.id)
                    .setLabel(q.label)
                    .setPlaceholder(q.placeholder)
                    .setStyle(q.style));
    
                modal.addComponents(...modalComponents);
                await interaction.showModal(modal);
            }
        });

         if (interaction.customId === 'ybasvuru') {
          const member = interaction.member;
          await interaction.reply({ content: `Ba≈üvurunuz Ba≈üarƒ±yla Alƒ±ndƒ±!`, ephemeral: true });
      
          const yBasvuruLog = client.guilds.cache.get(ertucuk.ServerID).channels.cache.find((channel) => channel.id === ertum.BasvuruLogChannel);
          const button = new ButtonBuilder().setCustomId('kabul').setLabel("Kabul Et").setStyle(ButtonStyle.Success);
          const button2 = new ButtonBuilder().setCustomId('reddet').setLabel("Reddet").setStyle(ButtonStyle.Danger);
          const row = new ActionRowBuilder().addComponents(button, button2);
          
          const soru1 = interaction.fields.getTextInputValue('soru1');
          const soru2 = interaction.fields.getTextInputValue('soru2');
          const soru3 = interaction.fields.getTextInputValue('soru3');
          const soru4 = interaction.fields.getTextInputValue('soru4');
      
          const createEmbed = (title, color, description) => {
            return new EmbedBuilder()
              .setTitle(title)
              .setColor(color)
              .setDescription(description);
          };
      
          const sendEmbed = (embed, components, message) => {
            yBasvuruLog.send({ embeds: [embed], components: components }).then((msg) => {
              const aButton = new ButtonBuilder().setCustomId('kabull').setLabel("Kabul Et").setStyle(ButtonStyle.Success).setDisabled(true);
              const dButton = new ButtonBuilder().setCustomId('reddet').setLabel("Reddet").setStyle(ButtonStyle.Danger).setDisabled(true);
              const row2 = new ActionRowBuilder().addComponents(aButton, dButton);



    },

    onCommand: async function (client, message, args, ertuembed) {

        message.channel.send({
            content:
                `${client.emoji("ertu_star")} A≈üaƒüƒ±daki Butonlar √úzerinden **ƒ∞stek,√ñneri,≈ûikayet** Veya **Yetkili Ba≈üvurusu** Yapabilirsiniz.`
            , components: [new ActionRowBuilder().addComponents(
                new ButtonBuilder()
                    .setCustomId("basvur")
                    .setLabel("Yetkili Ba≈üvur")
                    .setStyle(ButtonStyle.Primary)
                    .setEmoji("üõ°Ô∏è"),
                new ButtonBuilder()
                    .setCustomId("i√∂s")
                    .setLabel("ƒ∞stek & √ñneri & ≈ûikayet")
                    .setStyle(ButtonStyle.Primary)
                    .setEmoji("üì®"),
            )]
        });
    },
};

///////////// fonksiyonlar ///////////////////////////////
function createYetkiliBasvuru(client) {
    client.on(Events.InteractionCreate, async interaction => {
        if (interaction.customId == "basvur") {
            const modal = new ModalBuilder()
                .setCustomId("ybasvuru")
                .setTitle("Yetkili Ba≈üvurusu");

            const questions = [
                { id: "soru1", label: "ƒ∞sim Ve Ya≈üƒ±nƒ±z", placeholder: "Buraya ƒ∞sim Ve Ya≈üƒ±nƒ±zƒ± Yazƒ±n. / √ñrn: Ertu 18", style: TextInputStyle.Short },
                { id: "soru2", label: "G√ºnde Ka√ß Saat Aktifsiniz", placeholder: "G√ºnde Ka√ß Saat Aktif Olduƒüunuzu Yazƒ±n. / √ñrn: 8 Saat", style: TextInputStyle.Short },
                { id: "soru3", label: "Sunucumuz i√ßin neler yapabilirsiniz?", placeholder: "Ne Yapabileceƒüinizi Yazƒ±n. / √ñrn: 5 Davet", style: TextInputStyle.Short },
                { id: "soru4", label: "Bize biraz kendinizden bahseder misiniz?", placeholder: "Ne Yapmaktan Ho≈ülandƒ±ƒüƒ±nƒ±zƒ± Yazƒ±n. / √ñrn: Sohbet Etmek", style: TextInputStyle.Paragraph }
            ];

            const modalComponents = questions.map(q => new TextInputBuilder()
                .setCustomId(q.id)
                .setLabel(q.label)
                .setPlaceholder(q.placeholder)
                .setStyle(q.style));

            modal.addComponents(...modalComponents);
            await interaction.showModal(modal);
        }
    });

    client.on(Events.InteractionCreate, async (interaction) => {
        if (interaction.customId === 'ybasvuru') {
          const member = interaction.member;
          await interaction.reply({ content: `Ba≈üvurunuz Ba≈üarƒ±yla Alƒ±ndƒ±!`, ephemeral: true });
      
          const yBasvuruLog = client.guilds.cache.get(ertucuk.ServerID).channels.cache.find((channel) => channel.id === ertum.BasvuruLogChannel);
          const button = new ButtonBuilder().setCustomId('kabul').setLabel("Kabul Et").setStyle(ButtonStyle.Success);
          const button2 = new ButtonBuilder().setCustomId('reddet').setLabel("Reddet").setStyle(ButtonStyle.Danger);
          const row = new ActionRowBuilder().addComponents(button, button2);
          
          const soru1 = interaction.fields.getTextInputValue('soru1');
          const soru2 = interaction.fields.getTextInputValue('soru2');
          const soru3 = interaction.fields.getTextInputValue('soru3');
          const soru4 = interaction.fields.getTextInputValue('soru4');
      
          const createEmbed = (title, color, description) => {
            return new EmbedBuilder()
              .setTitle(title)
              .setColor(color)
              .setDescription(description);
          };
      
          const sendEmbed = (embed, components, message) => {
            yBasvuruLog.send({ embeds: [embed], components: components }).then((msg) => {
              const aButton = new ButtonBuilder().setCustomId('kabull').setLabel("Kabul Et").setStyle(ButtonStyle.Success).setDisabled(true);
              const dButton = new ButtonBuilder().setCustomId('reddet').setLabel("Reddet").setStyle(ButtonStyle.Danger).setDisabled(true);
              const row2 = new ActionRowBuilder().addComponents(aButton, dButton);
      
              client.on(Events.InteractionCreate, async (interaction) => {
                if (interaction.customId === "kabul") {
                  const aEmbed = createEmbed("Yetkili Ba≈üvuru [KABUL EDƒ∞LDƒ∞]", "#2b2d31", description);
                  await msg.edit({ embeds: [aEmbed], components: [row2] });
                  interaction.reply({ content: `Ba≈üarƒ±yla ${member} kullanƒ±cƒ±sƒ±nƒ±n ba≈üvurusunu onayladƒ±nƒ±z. `, ephemeral: true });
                  await member.send({ content: `${interaction.guild.name} Sunucusunda ba≈üvurunuz onaylandƒ±!` });
                  member.roles.add(ertum.StartAuthority);
                }
      
                if (interaction.customId === "reddet") {
                  const dEmbed = createEmbed("Yetkili Ba≈üvurusu [REDDEDƒ∞LDƒ∞]", "#2b2d31", description);
                  await msg.edit({ embeds: [dEmbed], components: [row2] });
                  interaction.reply({ content: `Ba≈üarƒ±yla ${member} kullanƒ±cƒ±sƒ±nƒ±n ba≈üvurusunu reddetiniz. `, ephemeral: true });
                  await member.send({ content: `${interaction.guild.name} Sunucusunda ba≈üvurunuz reddedildi!` });
                }
              });
            });
          };
      
          const initialEmbed = createEmbed("Yetkili Ba≈üvuru [BEKLEMEDE]", "#2b2d31", `
      **Kullanƒ±cƒ±:** ${interaction.user.displayName}(\`${interaction.user.id}\`)
      
      **„ÉªSoru 1:** ƒ∞sim Ve Ya≈üƒ±nƒ±z?
      \`\`\`
      ${soru1}
      \`\`\`
      **„ÉªSoru 2:** G√ºnde Ka√ß Saat Aktif Olduƒüunuzu Yazƒ±n?
      \`\`\` 
      ${soru2}
      \`\`\`
      **„ÉªSoru 3:** Sunucumuz i√ßin neler yapabilirsiniz? 
      \`\`\`
      ${soru3}
      \`\`\`
      **„ÉªSoru 4:** Bize biraz kendinizden bahseder misiniz?
      \`\`\`
      ${soru4} 
      \`\`\`
      
      **Not:** Onaylamak veya reddetmek i√ßin a≈üaƒüƒ±daki butonlarƒ± kullanƒ±nƒ±z.
      `);
          sendEmbed(initialEmbed, [row]);
        }
      });   
}

function createIstekOneriSikayet(client) {
    client.on(Events.InteractionCreate, async interaction => {
        if (interaction.customId == "i√∂s") {
            const modal = new ModalBuilder()
                .setCustomId("ibasvuru")
                .setTitle("ƒ∞stek √ñneri ≈ûikayet Talebi");

            const questions = [
                { id: "s1", label: "ƒ∞≈ülem T√ºr√ºn√ºz√º Yazƒ±nƒ±z", placeholder: "√ñrnek: ƒ∞stek/√ñneri/≈ûikayet", style: TextInputStyle.Short },
                { id: "s2", label: "Sorunuzu bildiriniz", placeholder: "√ñrnek: Sunucuya G√ºzel Sistemler eklensin.", style: TextInputStyle.Paragraph }
            ];

            const modalComponents = questions.map(q => new TextInputBuilder()
                .setCustomId(q.id)
                .setLabel(q.label)
                .setPlaceholder(q.placeholder)
                .setStyle(q.style));

            modal.addComponents(...modalComponents);
            await interaction.showModal(modal);
        }
    });

    client.on(Events.InteractionCreate, async (interaction) => {
        if (interaction.customId === 'ibasvuru') {
          await interaction.reply({ content: `Ba≈üvurunuz Ba≈üarƒ±yla Alƒ±ndƒ±!`, ephemeral: true });
      
          const iBasvuruLog = client.guilds.cache.get(ertucuk.ServerID).channels.cache.find((channel) => channel.id === ertum.IstekOneriSikayetLogChannel);
          const s1 = interaction.fields.getTextInputValue('s1');
          const s2 = interaction.fields.getTextInputValue('s2');
      
          const ertu = new EmbedBuilder()
        .setColor("#2b2d31")
        .setDescription(`
      **Kullanƒ±cƒ±:** ${interaction.user.displayName}(\`${interaction.user.id}\`)
      
      **„ÉªSoru 1:** ƒ∞≈ülem T√ºr√ºn√ºz√º Yazƒ±nƒ±z?
      \`\`\`
      ${s1}
      \`\`\`
      **„ÉªSoru 2:** Sorunuzu bildiriniz.
      \`\`\`
      ${s2}
      \`\`\`
      `);
          iBasvuruLog.send({ embeds: [ertu] });
        }
      });
      

}